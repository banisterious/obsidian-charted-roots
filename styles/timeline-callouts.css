/**
 * Timeline Callout Styles
 *
 * CSS for markdown timeline exports using nested callouts.
 * Compatible with Style Settings plugin for customization.
 *
 * Based on FireIsGood's timeline callout snippet:
 * https://discord.com/channels/686053708261228577/702656734631821413/1156868388249935883
 */

/* Timeline CSS Variables - defaults that can be overridden via Style Settings */
body {
  --cr-timeline-width: 100%;
  --cr-timeline-wide: 0; /* Set to 1 to enable wide mode */
  --cr-timeline-title-color: var(--text-normal);
  --cr-timeline-title-size: 1.5em;
  --cr-timeline-title-width: 150px;

  --cr-timeline-line-color: var(--color-base-35);
  --cr-timeline-line-margin: 16px;
  --cr-timeline-line-width: 4px;
  --cr-timeline-line-style: solid;

  --cr-timeline-dot-color: var(--color-base-70);
  --cr-timeline-dot-size: 32px;
  --cr-timeline-dot-radius: 100%;
  --cr-timeline-dot-border-color: var(--background-primary);
  --cr-timeline-dot-border-size: 6px;
  --cr-timeline-dot-offset-x: -18px;
  --cr-timeline-dot-offset-y: -2px;

  --cr-timeline-card-margin: 16px;
  --cr-timeline-card-background: var(--color-base-30);
  --cr-timeline-card-padding-x: 10px;
  --cr-timeline-card-padding-y: 16px;
  --cr-timeline-card-radius: 1rem;

  /* Event type colors */
  --cr-timeline-dot-birth: #4ade80;
  --cr-timeline-dot-death: #6b7280;
  --cr-timeline-dot-marriage: #f472b6;
  --cr-timeline-dot-divorce: #ef4444;
  --cr-timeline-dot-default: #60a5fa;
}

/* ============================================================================
   Timeline Outer Container
   ============================================================================ */

.callout[data-callout="cr-timeline-outer"] {
  border: 1px solid var(--background-modifier-border);
  border-radius: 6px;
  background-color: var(--background-secondary);
  padding: var(--cr-spacing-md);
  width: var(--cr-timeline-width);
}

.callout[data-callout="cr-timeline-outer"] > .callout-title {
  font-size: var(--h2-size);
  margin-bottom: var(--cr-spacing-md);
}

.callout[data-callout="cr-timeline-outer"] > .callout-title > .callout-icon {
  --icon-size: 1.1em;
}

/* Continuous vertical line drawn on the outer container's content area */
.callout[data-callout="cr-timeline-outer"] > .callout-content {
  position: relative;
}

.callout[data-callout="cr-timeline-outer"] > .callout-content::before {
  content: "";
  position: absolute;
  /* Align line center with dot center:
     The icon element is positioned at: title-width - line-margin - (icon-width / 2)
     Based on measurements: icon is ~130px from content, which equals
     title-width (150) - line-margin (16) - line-width/2 (2) = 132px (close enough)

     Dot left edge = icon-position + dot-offset-x
     Dot center = dot-left + dot-size/2
     Line left = dot-center - line-width/2 */
  left: calc(
    var(--cr-timeline-title-width) - var(--cr-timeline-line-margin) +
      var(--cr-timeline-dot-offset-x) + (var(--cr-timeline-dot-size) / 2) -
      (var(--cr-timeline-line-width) / 2) - 4px
  );
  top: 0;
  bottom: var(--cr-timeline-card-margin);
  width: var(--cr-timeline-line-width);
  background-color: var(--cr-timeline-line-color);
}

/* ============================================================================
   Timeline Entry (Year Row)
   ============================================================================ */

.callout[data-callout="cr-timeline"] {
  order: 1;
  padding: 0;
  margin: 0;
  display: grid;
  mix-blend-mode: normal;
  background-color: unset;
  grid-template-columns: var(--cr-timeline-title-width) auto;
  --dot-offset: calc(var(--cr-timeline-dot-offset-y) + var(--cr-timeline-card-padding-y));
}

/* Year/title column */
.callout[data-callout="cr-timeline"] .callout-title-inner {
  width: 100%;
  text-align: right;
  color: var(--cr-timeline-title-color);
  font-size: var(--cr-timeline-title-size);
  margin-top: var(--dot-offset);
}

/* Vertical line area with dot (line now drawn on outer container) */
.callout[data-callout="cr-timeline"] .callout-icon {
  order: 2;
  margin-inline: var(--cr-timeline-line-margin);
  width: var(--cr-timeline-line-width);
  height: 100%;
  position: relative;
}

/* The dot */
.callout[data-callout="cr-timeline"] .callout-icon::after {
  content: "";
  box-sizing: border-box;
  background-color: var(--cr-timeline-dot-color);
  position: absolute;
  border: var(--cr-timeline-dot-border-size) solid var(--cr-timeline-dot-border-color);
  border-radius: var(--cr-timeline-dot-radius);
  width: var(--cr-timeline-dot-size);
  height: var(--cr-timeline-dot-size);
  top: var(--dot-offset);
  left: var(--cr-timeline-dot-offset-x);
}

/* Hide the default SVG icon */
.callout[data-callout="cr-timeline"] .svg-icon {
  display: none;
}

/* Event content card */
.callout[data-callout="cr-timeline"] .callout-content {
  order: 3;
  --p-spacing: 0.5rem;
  background-color: var(--cr-timeline-card-background);
  border-radius: var(--cr-timeline-card-radius);
  margin-bottom: var(--cr-timeline-card-margin);
  padding: var(--cr-timeline-card-padding-x) var(--cr-timeline-card-padding-y);
}

.callout[data-callout="cr-timeline"] .callout-content > h2:first-child {
  margin-top: 0;
}

/* Spacing between stacked timelines */
div:not(:has(> [data-callout="cr-timeline"])) + div > [data-callout="cr-timeline"] {
  margin-top: var(--p-spacing);
}

div:has(> [data-callout="cr-timeline"]) + div:not(:has(> [data-callout="cr-timeline"])) {
  margin-bottom: 1rem;
}

/* ============================================================================
   Event Type Color Overrides (via callout metadata)
   ============================================================================ */

/* Standard Obsidian colors */
[data-callout="cr-timeline"][data-callout-metadata="red"] {
  --cr-timeline-dot-color: var(--color-red);
}
[data-callout="cr-timeline"][data-callout-metadata="orange"] {
  --cr-timeline-dot-color: var(--color-orange);
}
[data-callout="cr-timeline"][data-callout-metadata="yellow"] {
  --cr-timeline-dot-color: var(--color-yellow);
}
[data-callout="cr-timeline"][data-callout-metadata="green"] {
  --cr-timeline-dot-color: var(--color-green);
}
[data-callout="cr-timeline"][data-callout-metadata="cyan"] {
  --cr-timeline-dot-color: var(--color-cyan);
}
[data-callout="cr-timeline"][data-callout-metadata="blue"] {
  --cr-timeline-dot-color: var(--color-blue);
}
[data-callout="cr-timeline"][data-callout-metadata="purple"] {
  --cr-timeline-dot-color: var(--color-purple);
}
[data-callout="cr-timeline"][data-callout-metadata="pink"] {
  --cr-timeline-dot-color: var(--color-pink);
}

/* Semantic event type colors */
[data-callout="cr-timeline"][data-callout-metadata="birth"] {
  --cr-timeline-dot-color: var(--cr-timeline-dot-birth);
}
[data-callout="cr-timeline"][data-callout-metadata="death"] {
  --cr-timeline-dot-color: var(--cr-timeline-dot-death);
}
[data-callout="cr-timeline"][data-callout-metadata="marriage"] {
  --cr-timeline-dot-color: var(--cr-timeline-dot-marriage);
}
[data-callout="cr-timeline"][data-callout-metadata="divorce"] {
  --cr-timeline-dot-color: var(--cr-timeline-dot-divorce);
}

/* Extended grayscale colors */
[data-callout="cr-timeline"][data-callout-metadata="bright-gray"] {
  --cr-timeline-dot-color: #7e859f;
}
[data-callout="cr-timeline"][data-callout-metadata="gray"] {
  --cr-timeline-dot-color: var(--color-base-50);
}

/* ============================================================================
   List Styling within Timeline
   ============================================================================ */

.callout[data-callout="cr-timeline"] .callout-content ul {
  margin: 0;
  padding-left: 0;
  list-style: none;
}

/* Hide bullets on top-level event items */
.callout[data-callout="cr-timeline"] .callout-content > ul > li > .list-bullet,
.callout[data-callout="cr-timeline"] .callout-content > div > ul > li > .list-bullet {
  display: none;
}

.callout[data-callout="cr-timeline"] .callout-content ul li {
  margin-bottom: 0.5em;
}

.callout[data-callout="cr-timeline"] .callout-content ul li ul {
  margin-top: 0.25em;
  padding-left: 1em;
}

.callout[data-callout="cr-timeline"] .callout-content ul li ul li {
  font-size: 0.9em;
  color: var(--text-muted);
  margin-bottom: 0.25em;
}

/* Links within timeline */
.callout[data-callout="cr-timeline"] a.internal-link {
  color: var(--text-normal);
  text-decoration: none;
}

.callout[data-callout="cr-timeline"] a.internal-link:hover {
  color: var(--text-accent);
  text-decoration: underline;
}

/* ============================================================================
   Multi-Column List Support (bundled from MCL)
   Based on efemkay's Modular CSS Layout
   https://github.com/efemkay/obsidian-modular-css-layout
   ============================================================================ */

/* Variables for list columns */
body {
  --cr-list-min-width: 200px;
  --cr-list-column-gap: 1rem;
  --cr-list-column-rule-color: var(--background-modifier-border);
  --cr-list-column-rule-width: 0;
}

/* Multi-column layout for timeline event lists */
/* Applied to top-level lists within timeline callouts */
.callout[data-callout="cr-timeline"] .callout-content > ul,
.callout[data-callout="cr-timeline"] .callout-content > div > ul {
  column-width: var(--cr-list-min-width);
  column-gap: var(--cr-list-column-gap);
  column-rule: var(--cr-list-column-rule-width) solid var(--cr-list-column-rule-color);
}

/* Hide the #mcl/list-column tag if present */
.callout[data-callout="cr-timeline"] a.tag[href*="mcl/list-column"],
.callout[data-callout="cr-timeline"] a[href*="#mcl/list-column"] {
  display: none;
}

/* Prevent column breaks within list items */
.callout[data-callout="cr-timeline"] .callout-content ul li {
  break-inside: avoid;
}

/* ============================================================================
   Theme Adjustments
   ============================================================================ */

.theme-light .callout[data-callout="cr-timeline-outer"] {
  background-color: var(--background-primary-alt);
}

.theme-light .callout[data-callout="cr-timeline"] .callout-content {
  background-color: var(--background-secondary);
}

/* ============================================================================
   Wide Timeline Mode
   Based on MCL Wide Views approach - adjusts readable line width for notes
   containing timelines
   ============================================================================ */

/* When wide-timeline class is on body, increase file line width */
body.wide-timeline .view-content {
  --file-line-width: var(--cr-timeline-width);
}
